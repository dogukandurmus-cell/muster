name: Build Android APK

on:
  workflow_dispatch:
  push:
    branches: ["**"]

jobs:
  build-android:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    env:
      CI: true
      GRADLE_OPTS: "-Dorg.gradle.daemon=false -Dorg.gradle.jvmargs=-Xmx3g"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Proje kökünü bul (package.json hangi klasördeyse)
      - name: Locate project root
        shell: bash
        run: |
          echo "Workspace tree:"; ls -la
          PKG_DIR="."
          if [ ! -f package.json ]; then
            FOUND=$(find . -maxdepth 3 -name package.json -not -path "*/node_modules/*" | head -n 1 || true)
            if [ -z "$FOUND" ]; then
              echo "::error::package.json bulunamadı. src/, public/, package.json ve vite.config.ts repo'da olmalı."
              exit 1
